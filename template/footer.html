{% load static %}
<div class="footer"
     style="width: 100%; overflow: hidden; border-top: 1px solid #ff44ad; padding-top: 30px; padding-bottom: 30px;">

    <p style="text-align: center; margin-top: 30px; font-size: 12px;line-height: 25px; color: #666;">
        关于我们 | 联系我们 | 人才招聘 | 法律申明 | 网站地图<br>
        地址：湖北省武汉市洪山区<br>
        邮箱：123456@.com 招聘邮箱:123456.com<br>
        copyright @ 2000 - 2020 yuer.com ALL Rights Reserved 鄂ICP备123456号-1
    </p>
</div>
<script type="text/javascript">
    avalon.config({
        interpolate: ["{", "}"]
    });
    var vm = avalon.define({
            $id: "bodycont",
            names: '医院',
            a: 1,
            b: 1,
            getcodewenzi: '获取验证码',
            datasgyes: [],
            erjidatalist: [],
            zhuceDatas: {
                username: '',
                phone: '',
                password: '',
                verification_Code: ''
            },
            loginData: {
                username: '',
                password: ''
            },
            loginFun: function () {
                if (vm.loginData.username == '' || !vm.loginData.username) {
                    layer.msg('请填写正确的用户名');
                    return;
                }
                if (vm.loginData.password == '' || !vm.loginData.password) {
                    layer.msg('请填写正确的密码');
                    return;
                }
                $.ajax({
                    type: 'post',
                    url: 'users/login',
                    data: vm.loginData,
                    dataType: "json",
                    // timeout: 10000,
                    success: function (data) {
                        if (data.code == 200) {
                            layer.msg('登录成功，即将跳转到首页');
                            setTimeout(function () {
                                window.location.href = "/"
                            }, 2000)
                        } else {
                            layer.msg('登录不成功');
                            return;
                        }
                    }
                });
            },
            mimayanzheng: function (ml) {
                var reg = /^[\w]{6,12}$/
                if (ml.match(reg)) {
                    return true;
                } else {
                    return false;
                }
            },
            register: function () {
                if (vm.zhuceDatas.username == '' || !vm.zhuceDatas.username) {
                    layer.msg('请填写正确的用户名');
                    return;
                }
                if (vm.zhuceDatas.phone == '' || !vm.zhuceDatas.phone || !vm.validatorTel(vm.zhuceDatas.phone)) {
                    layer.msg('请填写正确的手机号');
                    return;
                }
                if (vm.zhuceDatas.password == '' || !vm.zhuceDatas.password || !vm.mimayanzheng(vm.zhuceDatas.password)) {
                    layer.msg('请填写正确的密码');
                    return;
                }
                if (vm.zhuceDatas.verification_Code == '' || !vm.zhuceDatas.verification_Code) {
                    layer.msg('请填写验证码');
                    return;
                }
                $.ajax({
                    type: 'post',
                    url: '/users/register',
                    data: vm.zhuceDatas,
                    dataType: "json",
                    // timeout: 10000,
                    success: function (data) {
                        console.log(data, 123);
                        if (data.code == 200) {
                            layer.msg('注册成功，即将跳转到登录页面');
                            setTimeout(function () {
                                vm.a = 1;
                            }, 2000)
                        } else {
                            layer.msg(data.msg);
                            return;
                        }
                    }
                });
            },
            validatorTel: function (content) {
                eval("var reg = /^1[34578]\\d{9}$/;");
                return RegExp(reg).test(content);
            }
            ,
            changedlorzc: function (id) {
                vm.a = id;
            },
            shiguanyiner: [
                {
                    name: '试管社区',
                    id: 1,
                    crruse: true
                },
                {
                    name: '输卵管问题',
                    id: 2,
                    crruse: false
                },
                {
                    name: '子宫问题',
                    id: 3,
                    crruse: false,
                },
                {
                    name: '高龄试管',
                    id: 4,
                    crruse: false
                },
                {
                    name: '染色体异常',
                    id: 5,
                    crruse: false
                },
                {
                    name: '精子问题',
                    id: 6,
                    crruse: false
                }
            ],
            getDatasgye: function (el, index) {
                vm.a = el.id;
            },
            indexs: '',
            changrightlm: function (id, index) {
                vm.b = id;
                vm.indexs = index;
                vm.erjidatalist = [];
                vm.erjidatalist = vm.datasgyes[index].children;
                if (vm.erjidatalist.length > 4) {
                    vm.erjidatalist = vm.erjidatalist.splice(0, 4);
                }
                console.log(vm.erjidatalist, 11111111);
            }

            ,
            getMorelist: function () {
                vm.erjidatalist = vm.datasgyes[vm.indexs].children;
            }
            ,
            rollbacklogin: function () {
                vm.a == 1;
            }
            ,
            getQueryVariable: function (variable) {
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for (var i = 0; i < vars.length; i++) {
                    var pair = vars[i].split("=");
                    if (pair[0] == variable) {
                        return pair[1];
                    }
                }
                return (false);
            }
            ,
            newartical: [],
            twotopNews: [],
            getNewArtical: function () {//获取百科推荐和上半部分的数据
                var count = {
                    count: 10
                };
                $.ajax({
                    type: 'post',
                    url: '/baike/api/articletimelist',
                    data: count,
                    dataType: "json",
                    // timeout: 10000,
                    success: function (data) {
                        vm.newartical = [];
                        vm.newartical = data.data;
                        if (vm.newartical.length > 1) {
                            vm.twotopNews.push(vm.newartical[0]);
                            vm.twotopNews.push(vm.newartical[1]);
                        }

                    }
                });
            },
            allbaikeData: [],
            getAllbaikeData: function () {//获取百科所有栏目
                var count = {
                    count: 12
                }
                $.ajax({
                    type: 'post',
                    url: '/baike/api/sgbk_sjldapi',
                    data: count,
                    dataType: "json",
                    // timeout: 10000,
                    success: function (data) {
                        vm.allbaikeData = data;
                        vm.datasgyes = data;
                        var zhou = vm.getQueryVariable('types');
                        if (zhou > 0) {
                            vm.changrightlm(zhou, zhou - 1);
                        } else {
                            vm.changrightlm(1, 0);
                        }
                    }
                });
            },
            getCode: function () { //获取验证码
                if (vm.zhuceDatas.phone == '' || !vm.zhuceDatas.phone || !vm.validatorTel(vm.zhuceDatas.phone)) {
                    layer.msg('请填写正确的手机号');
                    return;
                }
                var time = 60;
                if (time == 60) {
                    var time1 = setInterval(function () {
                        if (time == 0) {
                            vm.getcodewenzi = '重新发送'
                            $("#sendsms").removeAttr("disabled");
                            time = 60;
                            clearInterval(time1);
                        } else {
                            $("#sendsms").attr("disabled", "true");
                            vm.getcodewenzi = "重新发送(" + time + ")";
                            time--;
                        }
                    }, 1000);
                }
                var phone = {
                    phone: vm.zhuceDatas.phone
                }
                $.ajax({
                    type: 'post',
                    url: '/users/smsvif',
                    data: phone,
                    dataType: "json",
                    // timeout: 10000,
                    success: function (data) {
                        console.log(data);
                    }
                });
            }
        }
    )
    vm.getAllbaikeData();
    vm.getNewArtical();
</script>


