<!DOCTYPE html>
<html>
<head>
    <title>互助问答列表</title>
    {% load static %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <meta name=renderer content=webkit>
    <script type="text/javascript" src="{% static  "js/jquery.min.js" %}"></script>
    <script type="text/javascript" src="{% static  "layui/layui.all.js" %}"></script>
    <script type="text/javascript" src="{% static  "js/swiper-bundle.min.js" %}"></script>
    <script type="text/javascript" src="{% static  "js/avalon.js" %}"></script>
    <script type="text/javascript" src="{% static  "js/index.js" %}"></script>
    <script type="text/javascript" src="{% static  "js/uitls/tool.js" %}"></script>
    <link rel="stylesheet" type="text/css" href="{% static  "css/swiper-bundle.min.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static  "css/css.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static  "css/index.css" %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/hzwd.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static  "layui/css/layui.css" %}">
</head>

{% include 'config.html' %}
{% include 'header.html' %}
<div class="hzwdbanner"><img src="{% static  "img/hzwdbanner.png" %}"></div>

<div class="hzwdconts" ms-controller="hzwdlist">
    <div class="hzwdlefts">
        <h3 style="font-size: 16px; padding: 15px;" ms-repeat="groupsdata">{el.name}</h3>
        <ul>
            <li ms-attr-class="tid==el.id?'curreswd':''" ms-repeat="allgroupData">
                <a ms-attr-href="/taolun/postindex/?tid={el.id}">{el.name}</a>
            </li>

        </ul>
        <div class="fenleiallswd">
            <p class="allcurr" order="">最新</p>
            <p order="1">热门</p>
            <p order="2">求助</p>
        </div>

        <div class="hzwdcontslist">
            <div class="partwdone" ms-repeat-its="lisdata">
                <img ms-attr-src="/media/{its.user.head}" style="float: left; margin-right: 10px;">
                <h4><a ms-attr-href="/taolun/toposting/?pid={its.id}">{its.title}</a></h4>
                <p>{its.user.username} <i class="layui-icon">&#xe68d;</i> {its.publish_date.replace(/:.*/,'')}
                    {% if request.user.is_active %}
                        <a href="javascript:;" ms-click="dianz(its.id,this)" ms-attr-isthumup="its.isthumbup" ms-attr-class="its.isthumbup==1?'isthumbup':''">
                            <abbr style="float: right; margin-right: 48px;">
                                <i class="layui-icon">&#xe6c6;</i>{its.thumbup}
                            </abbr>
                        </a>
                    {% else %}
                        <a href="/login">
                            <abbr style="float: right; margin-right: 48px;">
                                <i class="layui-icon">&#xe6c6;</i>
                            </abbr>
                        </a>
                    {% endif %}
                </p>
            </div>

            <div id="pagers"></div>
        </div>


    </div>
    <div class="hzwdrights">
        <div class="metry">
            {% if request.user.is_active %}
                <a href="/taolun/topost/"><img src="{% static  "img/340.png" %}"></a>
            {% else %}
                <a href="/login"><img src="{% static  "img/340.png" %}"></a>
            {% endif %}
        </div>
        <div class="szzhuanjia">
            <h3><abbr>生殖专家推荐</abbr> <a href="###">更多>></a></h3>
            <div class="doctorbox">
                <img src="{% static  "img/doctor.png" %}" style="float: left; margin: 20px 15px 0 0;">
                <h4 style="margin-top: 20px;">医生名称 <abbr>医生职位</abbr></h4>
                <p style=" font-size: 14px;">所在医院名称</p>
                <p style=" font-size: 14px; margin-top: 10px;">医院介绍文案，点击查看医生详情，只能显示二行多的...</p>
                <a href="###">向他提问</a>
            </div>
        </div>
        <div class="szzhuanjia">
            <h3><abbr>热门问答推荐</abbr> <a href="###">更多>></a></h3>
            <div class="hotwdtuijian">
                <ul>
                    <li>
                        <a href="###">话题标签话题标签话题标签话题标签</a>
                        <abbr>999个问答</abbr>
                    </li>
                    <li>
                        <a href="###">话题标签话题标签话题标签</a>
                        <abbr>999个问答</abbr>
                    </li>
                    <li>
                        <a href="###">话题标签</a>
                        <abbr>999个问答</abbr>
                    </li>
                    <li>
                        <a href="###">话题话题标签话题标签话题标签话题标签标签</a>
                        <abbr>999个问答</abbr>
                    </li>
                    <li>
                        <a href="###">话题话题标签话题标签标签</a>
                        <abbr>999个问答</abbr>
                    </li>
                    <li>
                        <a href="###">话题话题标签标签</a>
                        <abbr>999个问答</abbr>
                    </li>
                    <li>
                        <a href="###">话题标签</a>
                        <abbr>999个问答</abbr>
                    </li>
                    <li>
                        <a href="###">话题标签</a>
                        <abbr>999个问答</abbr>
                    </li>
                    <li>
                        <a href="###">话题标签</a>
                        <abbr>999个问答</abbr>
                    </li>
                    <li>
                        <a href="###">话题标签</a>
                        <abbr>999个问答</abbr>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>


<!-- 底部 -->
{% include 'footer.html' %}

<script>
    var vm_hzwdlist = avalon.define({
        $id: "hzwdlist",
        count: 0,//数据总条数
        Mid: '',
        tid: '',
        order: '',
        limites: 10,//每一页显示多少条
        btnnum: 5,//按钮显示个数
        groupsdata: [],
        allgroupData: [],
        lisdata: [],
        intopages: function () {
            layui.use('laypage', function () {
                var laypage = layui.laypage;
                laypage.render({
                    elem: 'pagers',
                    count: vm_hzwdlist.count,
                    limit: vm_hzwdlist.limites,
                    curr: location.hash.replace('#!page=', ''),
                    hash: 'page',
                    groups: vm_hzwdlist.btnnum,
                    layout: ['count', 'prev', 'page', 'next', 'refresh', 'skip'],
                    jump: function (obj) {
                        vm_hzwdlist.goPage(obj.curr);
                    }
                });
            });
        },
        menuClick: function () {
            var menuBtn = $('.fenleiallswd>p');
            var url = '';
            for (let i = 0; i < menuBtn.length; i++) {
                menuBtn.eq(i).click(function () {
                    Toolfun.clearClass("allcurr", menuBtn);
                    vm_hzwdlist.order = $(this).attr('order');
                    $(this).addClass('allcurr');
                    if (vm_hzwdlist.order) {
                        url = root_Domain + '/taolun/postinglist/?tid=' + vm_hzwdlist.tid + '&num=' + vm_hzwdlist.limites + '&order=' + vm_hzwdlist.order;
                    } else {
                        url = root_Domain + '/taolun/postinglist/?tid=' + vm_hzwdlist.tid + '&num=' + vm_hzwdlist.limites;
                    }
                    $.ajax({
                        url: url,
                        type: 'get',
                        dataType: 'json',
                        success: function (ajax) {
                            location.hash = '';
                            vm_hzwdlist.count = ajax.maxnum;
                            vm_hzwdlist.lisdata = ajax.data;
                            vm_hzwdlist.intopages();
                        }, error: function (error) {
                            console.log(error);
                        }
                    })
                })
            }
        },
        dianz: function (id, ev) {
            var _this = ev;
            if ($(_this).attr('isthumup')==1) {
                layer.msg('请勿重复点赞！！！', {time: 1000});
                return '';
            } else {
                vm_hzwdlist.dzid = id;
                $.ajax({
                    url: root_Domain + '/taolun/thumbup/?type=article&id=' + id,
                    type: 'get',
                    dataType: 'text',
                    success: function (ajax) {
                        layer.msg(ajax, {time: 1000});
                        setTimeout(function () {
                            location.reload();
                        }, 2000)
                    },
                    error: function (error) {
                        console.log(error);
                    }
                })
            }
        },
        goPage: function (page) {
            var url = '';
            if (vm_hzwdlist.order) {
                url = root_Domain + '/taolun/postinglist/?tid=' + vm_hzwdlist.tid + '&num=' + vm_hzwdlist.limites + '&page=' + page + '&order=' + vm_hzwdlist.order;
            } else {
                url = root_Domain + '/taolun/postinglist/?tid=' + vm_hzwdlist.tid + '&num=' + vm_hzwdlist.limites + '&page=' + page;
            }
            $.ajax({
                url: url,
                type: 'get',
                dataType: 'json',
                success: function (ajax) {
                    vm_hzwdlist.lisdata = ajax.data;
                }, error: function (error) {
                    console.log(error);
                }
            })
        },
        init: function () {
            vm_hzwdlist.Mid = localStorage.getItem('Mid');
            var Mgroupdata = JSON.parse(localStorage.getItem('Mgroup'));
            for (let i = 0; i < Mgroupdata.length; i++) {
                if (Mgroupdata[i].id == vm_hzwdlist.Mid) {
                    vm_hzwdlist.groupsdata.push(Mgroupdata[i]);
                }
            }
            vm_hzwdlist.allgroupData = JSON.parse(localStorage.getItem('sonGroup'));
            if (location.hash) {
                location.hash = '';
                vm_hzwdlist.tid = location.href.replace(/.*tid=/, '').replace(/#/, '');
            } else {
                vm_hzwdlist.tid = location.href.replace(/.*tid=/, '').replace(/#/, '');
            }
            $.ajax({
                url: root_Domain + '/taolun/postinglist/?tid=' + vm_hzwdlist.tid + '&num=' + vm_hzwdlist.limites,
                type: 'get',
                dataType: 'json',
                success: function (ajax) {
                    vm_hzwdlist.count = ajax.maxnum;
                    vm_hzwdlist.lisdata = ajax.data;
                    vm_hzwdlist.intopages();
                    vm_hzwdlist.menuClick();
                },
                error: function (error) {
                    console.log(error);
                }
            })
        }
    })
    vm_hzwdlist.init();
</script>
</body>
</html>